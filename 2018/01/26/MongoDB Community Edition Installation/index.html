<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="MongoDB," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="Configure the package management system (yum).Create a /etc/yum.repos.d/mongodb-org-3.6.repo file so that you can install MongoDB directly, using yum.
Changed in version 3.0: MongoDB Linux packages ar">
<meta property="og:type" content="article">
<meta property="og:title" content="MongoDB Community Edition Installation">
<meta property="og:url" content="http://charles.pub/2018/01/26/MongoDB Community Edition Installation/index.html">
<meta property="og:site_name" content="“运维 - 架构”">
<meta property="og:description" content="Configure the package management system (yum).Create a /etc/yum.repos.d/mongodb-org-3.6.repo file so that you can install MongoDB directly, using yum.
Changed in version 3.0: MongoDB Linux packages ar">
<meta property="og:updated_time" content="2018-01-26T10:39:58.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MongoDB Community Edition Installation">
<meta name="twitter:description" content="Configure the package management system (yum).Create a /etc/yum.repos.d/mongodb-org-3.6.repo file so that you can install MongoDB directly, using yum.
Changed in version 3.0: MongoDB Linux packages ar">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: 'U8RQYDSHQE',
      apiKey: '4e3ee6017aa53b87273a8f9c07c6fad8',
      indexName: 'BlogIndex',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://charles.pub/2018/01/26/MongoDB Community Edition Installation/"/>





  <title> MongoDB Community Edition Installation | “运维 - 架构” </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?b71d9b907f3535ada947168b45eb247b";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">“运维 - 架构”</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://charles.pub/2018/01/26/MongoDB Community Edition Installation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qingyu.li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="“运维 - 架构”">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                MongoDB Community Edition Installation
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-26T12:57:39+08:00">
                2018-01-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/NoSQL/" itemprop="url" rel="index">
                    <span itemprop="name">NoSQL</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/01/26/MongoDB Community Edition Installation/" class="leancloud_visitors" data-flag-title="MongoDB Community Edition Installation">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="Configure-the-package-management-system-yum"><a href="#Configure-the-package-management-system-yum" class="headerlink" title="Configure the package management system (yum)."></a>Configure the package management system (yum).</h2><p>Create a /etc/yum.repos.d/mongodb-org-3.6.repo file so that you can install MongoDB directly, using yum.</p>
<p>Changed in version 3.0: MongoDB Linux packages are in a new repository beginning with 3.0.</p>
<h3 id="For-MongoDB-3-6"><a href="#For-MongoDB-3-6" class="headerlink" title="For MongoDB 3.6"></a>For MongoDB 3.6</h3><p>Use the following repository file:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@centos ~]<span class="comment"># vi /etc/yum.repos.d/mongodb-org-3.6.repo</span></div><div class="line">[mongodb-org-3.6]</div><div class="line">name=MongoDB Repository</div><div class="line">baseurl=https://repo.mongodb.org/yum/redhat/<span class="variable">$releasever</span>/mongodb-org/3.6/x86_64/</div><div class="line">gpgcheck=1</div><div class="line">enabled=1</div><div class="line">gpgkey=https://www.mongodb.org/static/pgp/server-3.6.asc</div></pre></td></tr></table></figure></p>
<h3 id="For-versions-of-MongoDB-earlier-than-3-6"><a href="#For-versions-of-MongoDB-earlier-than-3-6" class="headerlink" title="For versions of MongoDB earlier than 3.6"></a>For versions of MongoDB earlier than 3.6</h3><p>To install the packages from an earlier release series such as 3.4, you can specify the release series in the repository configuration. For example, to restrict your system to the 3.4 release series, create a /etc/yum.repos.d/mongodb-org-3.4.repo file to hold the following configuration information for the MongoDB 3.4 repository:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[mongodb-org-3.4]</div><div class="line">name=MongoDB 3.4 Repository</div><div class="line">baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/3.4/x86_64/</div><div class="line">gpgcheck=0</div><div class="line">enabled=1</div></pre></td></tr></table></figure></p>
<p>You can find .repo files for each release <a href="https://repo.mongodb.org/yum/redhat/" target="_blank" rel="external">in the repository itself</a>. </p>
<p>Remember that odd-numbered minor release versions (e.g. 3.5) are development versions and are unsuitable for production use.</p>
<h2 id="Install-the-MongoDB-packages"><a href="#Install-the-MongoDB-packages" class="headerlink" title="Install the MongoDB packages."></a>Install the MongoDB packages.</h2><p>To install the latest stable version of MongoDB, issue the following command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo yum install -y mongodb-org</div></pre></td></tr></table></figure>
<p>To install a specific release of MongoDB, specify each component package individually and append the version number to the package name, as in the following example:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo yum install -y mongodb-org-3.6.2 mongodb-org-server-3.6.2 mongodb-org-shell-3.6.2 mongodb-org-mongos-3.6.2 mongodb-org-tools-3.6.2</div></pre></td></tr></table></figure>
<p>You can specify any available version of MongoDB. However yum will upgrade the packages when a newer version becomes available. To prevent unintended upgrades, pin the package. To pin a package, add the following exclude directive to your /etc/yum.conf file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">exclude=mongodb-org,mongodb-org-server,mongodb-org-shell,mongodb-org-mongos,mongodb-org-tools</div></pre></td></tr></table></figure>
<h2 id="Run-MongoDB-Community-Edition"><a href="#Run-MongoDB-Community-Edition" class="headerlink" title="Run MongoDB Community Edition"></a>Run MongoDB Community Edition</h2><h3 id="Configure-SELinux"><a href="#Configure-SELinux" class="headerlink" title="Configure SELinux"></a>Configure SELinux</h3><p>Disable SELinux by setting the SELINUX setting to disabled in /etc/selinux/config.</p>
<h3 id="Data-Directories-and-Permissions"><a href="#Data-Directories-and-Permissions" class="headerlink" title="Data Directories and Permissions"></a>Data Directories and Permissions</h3><p>The MongoDB instance stores its data files in /var/lib/mongo and its log files in /var/log/mongodb by default, and runs using the mongod user account. You can specify alternate log and data file directories in /etc/mongod.conf. See systemLog.path and storage.dbPath for additional information.</p>
<p>If you change the user that runs the MongoDB process, you must modify the access control rights to the /var/lib/mongo and /var/log/mongodb directories to give this user access to these directories.</p>
<h3 id="Procedure"><a href="#Procedure" class="headerlink" title="Procedure"></a>Procedure</h3><h4 id="Start-MongoDB"><a href="#Start-MongoDB" class="headerlink" title="Start MongoDB."></a>Start MongoDB.</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo service mongod start</div></pre></td></tr></table></figure>
<h4 id="Verify-that-MongoDB-has-started-successfully"><a href="#Verify-that-MongoDB-has-started-successfully" class="headerlink" title="Verify that MongoDB has started successfully."></a>Verify that MongoDB has started successfully.</h4><p>ou can verify that the mongod process has started successfully by checking the contents of the log file at /var/log/mongodb/mongod.log for a line reading</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[initandlisten] waiting <span class="keyword">for</span> connections on port &lt;port&gt;</div></pre></td></tr></table></figure>
<p>where <port> is the port configured in /etc/mongod.conf, 27017 by default.</port></p>
<p>You can optionally ensure that MongoDB will start following a system reboot by issuing the following command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo chkconfig mongod on</div></pre></td></tr></table></figure>
<h4 id="Stop-MongoDB"><a href="#Stop-MongoDB" class="headerlink" title="Stop MongoDB."></a>Stop MongoDB.</h4><p>As needed, you can stop the mongod process by issuing the following command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo service mongod stop</div></pre></td></tr></table></figure>
<h4 id="Restart-MongoDB"><a href="#Restart-MongoDB" class="headerlink" title="Restart MongoDB."></a>Restart MongoDB.</h4><p>You can restart the mongod process by issuing the following command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo service mongod restart</div></pre></td></tr></table></figure>
<p>You can follow the state of the process for errors or important messages by watching the output in the /var/log/mongodb/mongod.log file.</p>
<h4 id="Begin-using-MongoDB"><a href="#Begin-using-MongoDB" class="headerlink" title="Begin using MongoDB."></a>Begin using MongoDB.</h4><p>Start a mongo shell on the same host machine as the mongod. Use the –host command line option to specify the localhost address and port that the mongod listens on:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongo --host 127.0.0.1:27017</div></pre></td></tr></table></figure>
<p>Later, to stop MongoDB, press Control+C in the terminal where the mongod instance is running.</p>
<h2 id="Uninstall-MongoDB-Community-Edition"><a href="#Uninstall-MongoDB-Community-Edition" class="headerlink" title="Uninstall MongoDB Community Edition"></a>Uninstall MongoDB Community Edition</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">sudo service mongod stop</div><div class="line">sudo yum erase $(rpm -qa | grep mongodb-org)</div><div class="line">sudo rm -r /var/<span class="built_in">log</span>/mongodb</div><div class="line">sudo rm -r /var/lib/mongo</div></pre></td></tr></table></figure>
<h2 id="集群配置"><a href="#集群配置" class="headerlink" title="集群配置"></a>集群配置</h2><h3 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># curl -O https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-3.6.2.tgz</span></div><div class="line"><span class="comment"># tar -xf mongodb-linux-x86_64-3.6.2.tgz -C /export/</span></div><div class="line"><span class="comment"># mv mongodb-linux-x86_64-3.6.2 mongodb</span></div><div class="line"><span class="comment"># vim /etc/profile</span></div><div class="line"><span class="built_in">export</span> MONGODB_HOME=/<span class="built_in">export</span>/mongodb</div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$MONGODB_HOME</span>/bin:<span class="variable">$PATH</span></div><div class="line"><span class="comment"># source /etc/profile</span></div></pre></td></tr></table></figure>
<h3 id="config-server-配置服务器"><a href="#config-server-配置服务器" class="headerlink" title="config server 配置服务器"></a>config server 配置服务器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">mkdir -p /<span class="built_in">export</span>/mongodb/config/&#123;data,<span class="built_in">log</span>&#125;</div><div class="line">vim /<span class="built_in">export</span>/mongodb/config/config.conf</div><div class="line"><span class="comment">## content</span></div><div class="line">systemLog:</div><div class="line">  destination: file</div><div class="line">  <span class="built_in">log</span>Append: <span class="literal">true</span></div><div class="line">  path: /<span class="built_in">export</span>/mongodb/config/<span class="built_in">log</span>/config.log</div><div class="line"> </div><div class="line"><span class="comment"># Where and how to store data.</span></div><div class="line">storage:</div><div class="line">  dbPath: /<span class="built_in">export</span>/mongodb/config/data</div><div class="line">  journal:</div><div class="line">    enabled: <span class="literal">true</span></div><div class="line"><span class="comment"># how the process runs</span></div><div class="line">processManagement:</div><div class="line">  fork: <span class="literal">true</span></div><div class="line">  pidFilePath: /<span class="built_in">export</span>/mongodb/config/configsrv.pid</div><div class="line"> </div><div class="line"><span class="comment"># network interfaces</span></div><div class="line">net:</div><div class="line">  port: 21000</div><div class="line">  <span class="built_in">bind</span>Ip: 10.131.185.18</div><div class="line"> </div><div class="line"><span class="comment">#operationProfiling:</span></div><div class="line">replication:</div><div class="line">    replSetName: config        </div><div class="line"></div><div class="line">sharding:</div><div class="line">    clusterRole: configsvr</div><div class="line"></div><div class="line"><span class="comment"># 启动</span></div><div class="line"><span class="comment"># yum install numactl</span></div><div class="line">numactl --interleave=all mongod --config /<span class="built_in">export</span>/mongodb/config/config.conf</div></pre></td></tr></table></figure>
<h3 id="第一个分片副本集"><a href="#第一个分片副本集" class="headerlink" title="第一个分片副本集"></a>第一个分片副本集</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">mkdir -p shard1/&#123;log,data&#125;</div><div class="line"></div><div class="line"># vim /export/mongodb/shard1/shard1.conf</div><div class="line"># where to write logging data.</div><div class="line">systemLog:</div><div class="line">  destination: file</div><div class="line">  logAppend: true</div><div class="line">  path: /export/mongodb/shard1/log/shard1.log</div><div class="line"> </div><div class="line"># Where and how to store data.</div><div class="line">storage:</div><div class="line">  dbPath: /export/mongodb/shard1/data</div><div class="line">  journal:</div><div class="line">    enabled: true</div><div class="line">  wiredTiger:</div><div class="line">    engineConfig:</div><div class="line">       cacheSizeGB: 20</div><div class="line"></div><div class="line"># how the process runs</div><div class="line">processManagement:</div><div class="line">  fork: true </div><div class="line">  pidFilePath: /export/mongodb/shard1/shard1.pid</div><div class="line"> </div><div class="line"># network interfaces</div><div class="line">net:</div><div class="line">  port: 27001</div><div class="line">  bindIp: 10.131.185.16</div><div class="line"></div><div class="line">#operationProfiling:</div><div class="line">replication:</div><div class="line">    replSetName: shard1</div><div class="line">sharding:</div><div class="line">    clusterRole: shardsvr</div><div class="line"></div><div class="line"># chown -R mongod:mongod /export/mongodb/shard1</div><div class="line"># vim shard1</div><div class="line"># chmod +x shard1</div><div class="line"># ./shard1 start</div></pre></td></tr></table></figure>
<p>登陆任意一台非仲裁服务器，初始化副本集</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">mongo 10.131.185.16:27001</div><div class="line">#使用admin数据库</div><div class="line">use admin</div><div class="line">#定义副本集配置</div><div class="line">config = &#123;</div><div class="line">  _id : &quot;shard1&quot;,</div><div class="line">    members : [</div><div class="line">     &#123;_id : 0, host : &quot;10.131.185.16:27001&quot; &#125;,</div><div class="line">     &#123;_id : 1, host : &quot;10.131.185.17:27001&quot; &#125;,</div><div class="line">     &#123;_id : 2, host : &quot;10.131.185.18:27001&quot;, arbiterOnly : true&#125;</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line"></div><div class="line"></div><div class="line">#初始化副本集配置</div><div class="line">rs.initiate(config);</div><div class="line"></div><div class="line"></div><div class="line">#查看分区状态</div><div class="line">rs.status();</div></pre></td></tr></table></figure>
<h3 id="第二个分片副本集"><a href="#第二个分片副本集" class="headerlink" title="第二个分片副本集"></a>第二个分片副本集</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">mkdir -p /export/mongodb/shard2/&#123;log,data&#125;</div><div class="line"></div><div class="line"># vim /export/mongodb/shard2/shard2.conf</div><div class="line"># where to write logging data.</div><div class="line">systemLog:</div><div class="line">  destination: file</div><div class="line">  logAppend: true</div><div class="line">  path: /export/mongodb/shard2/log/shard2.log</div><div class="line"> </div><div class="line"># Where and how to store data.</div><div class="line">storage:</div><div class="line">  dbPath: /export/mongodb/shard2/data</div><div class="line">  journal:</div><div class="line">    enabled: true</div><div class="line">  wiredTiger:</div><div class="line">    engineConfig:</div><div class="line">       cacheSizeGB: 20</div><div class="line"></div><div class="line"># how the process runs</div><div class="line">processManagement:</div><div class="line">  fork: true </div><div class="line">  pidFilePath: /export/mongodb/shard2/shard2.pid</div><div class="line"> </div><div class="line"># network interfaces</div><div class="line">net:</div><div class="line">  port: 27002</div><div class="line">  bindIp: 10.131.185.17</div><div class="line"></div><div class="line">#operationProfiling:</div><div class="line">replication:</div><div class="line">    replSetName: shard2</div><div class="line">sharding:</div><div class="line">    clusterRole: shardsvr</div><div class="line"></div><div class="line"># chown -R mongod:mongod /export/mongodb/shard2</div><div class="line"># vim /export/mongodb/shard2/shard2</div><div class="line"># chmod +x /export/mongodb/shard2/shard2</div><div class="line"># /export/mongodb/shard2/shard2 start</div></pre></td></tr></table></figure>
<p>登陆任意一台非仲裁服务器，初始化副本集</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">mongo 10.131.185.17:27002</div><div class="line">#使用admin数据库</div><div class="line">use admin</div><div class="line">#定义副本集配置</div><div class="line">config = &#123;</div><div class="line">  _id : &quot;shard2&quot;,</div><div class="line">    members : [</div><div class="line">     &#123;_id : 0, host : &quot;10.131.185.17:27002&quot; &#125;,</div><div class="line">     &#123;_id : 1, host : &quot;10.131.185.18:27002&quot; &#125;,</div><div class="line">     &#123;_id : 2, host : &quot;10.131.185.19:27002&quot;, arbiterOnly : true&#125;</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line"></div><div class="line"></div><div class="line">#初始化副本集配置</div><div class="line">rs.initiate(config);</div><div class="line"></div><div class="line"></div><div class="line">#查看分区状态</div><div class="line">rs.status();</div></pre></td></tr></table></figure>
<h3 id="第三个分片副本集"><a href="#第三个分片副本集" class="headerlink" title="第三个分片副本集"></a>第三个分片副本集</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">mkdir -p /export/mongodb/shard3/&#123;log,data&#125;</div><div class="line"></div><div class="line"># vim /export/mongodb/shard3/shard3.conf</div><div class="line"># where to write logging data.</div><div class="line">systemLog:</div><div class="line">  destination: file</div><div class="line">  logAppend: true</div><div class="line">  path: /export/mongodb/shard3/log/shard3.log</div><div class="line"> </div><div class="line"># Where and how to store data.</div><div class="line">storage:</div><div class="line">  dbPath: /export/mongodb/shard3/data</div><div class="line">  journal:</div><div class="line">    enabled: true</div><div class="line">  wiredTiger:</div><div class="line">    engineConfig:</div><div class="line">       cacheSizeGB: 20</div><div class="line"></div><div class="line"># how the process runs</div><div class="line">processManagement:</div><div class="line">  fork: true </div><div class="line">  pidFilePath: /export/mongodb/shard3/shard3.pid</div><div class="line"> </div><div class="line"># network interfaces</div><div class="line">net:</div><div class="line">  port: 27003</div><div class="line">  bindIp: 10.131.185.18</div><div class="line"></div><div class="line">#operationProfiling:</div><div class="line">replication:</div><div class="line">    replSetName: shard3</div><div class="line">sharding:</div><div class="line">    clusterRole: shardsvr</div><div class="line"></div><div class="line"># chown -R mongod:mongod /export/mongodb/shard3</div><div class="line"># vim /export/mongodb/shard3/shard3</div><div class="line"># chmod +x /export/mongodb/shard3/shard3</div><div class="line"># /export/mongodb/shard3/shard3 start</div></pre></td></tr></table></figure>
<p>登陆任意一台非仲裁服务器，初始化副本集</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">mongo 10.131.185.18:27003</div><div class="line">#使用admin数据库</div><div class="line">use admin</div><div class="line">#定义副本集配置</div><div class="line">config = &#123;</div><div class="line">  _id : &quot;shard3&quot;,</div><div class="line">    members : [</div><div class="line">     &#123;_id : 0, host : &quot;10.131.185.18:27003&quot; &#125;,</div><div class="line">     &#123;_id : 1, host : &quot;10.131.185.19:27003&quot; &#125;,</div><div class="line">     &#123;_id : 2, host : &quot;10.131.185.20:27003&quot;, arbiterOnly : true&#125;</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line"></div><div class="line"></div><div class="line">#初始化副本集配置</div><div class="line">rs.initiate(config);</div><div class="line"></div><div class="line"></div><div class="line">#查看分区状态</div><div class="line">rs.status();</div></pre></td></tr></table></figure>
<h3 id="第四个分片副本集"><a href="#第四个分片副本集" class="headerlink" title="第四个分片副本集"></a>第四个分片副本集</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">mkdir -p /export/mongodb/shard4/&#123;log,data&#125;</div><div class="line"></div><div class="line"># vim /export/mongodb/shard4/shard4.conf</div><div class="line"># where to write logging data.</div><div class="line">systemLog:</div><div class="line">  destination: file</div><div class="line">  logAppend: true</div><div class="line">  path: /export/mongodb/shard4/log/shard4.log</div><div class="line"> </div><div class="line"># Where and how to store data.</div><div class="line">storage:</div><div class="line">  dbPath: /export/mongodb/shard4/data</div><div class="line">  journal:</div><div class="line">    enabled: true</div><div class="line">  wiredTiger:</div><div class="line">    engineConfig:</div><div class="line">       cacheSizeGB: 20</div><div class="line"></div><div class="line"># how the process runs</div><div class="line">processManagement:</div><div class="line">  fork: true </div><div class="line">  pidFilePath: /export/mongodb/shard4/shard4.pid</div><div class="line"> </div><div class="line"># network interfaces</div><div class="line">net:</div><div class="line">  port: 27004</div><div class="line">  bindIp: 10.131.185.19</div><div class="line"></div><div class="line">#operationProfiling:</div><div class="line">replication:</div><div class="line">    replSetName: shard4</div><div class="line">sharding:</div><div class="line">    clusterRole: shardsvr</div><div class="line"></div><div class="line"># chown -R mongod:mongod /export/mongodb/shard4</div><div class="line"># vim /export/mongodb/shard4/shard4</div><div class="line"># chmod +x /export/mongodb/shard4/shard4</div><div class="line"># /export/mongodb/shard4/shard4 start</div></pre></td></tr></table></figure>
<p>登陆任意一台非仲裁服务器，初始化副本集</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">mongo 10.131.185.20:27004</div><div class="line">#使用admin数据库</div><div class="line">use admin</div><div class="line">#定义副本集配置</div><div class="line">config = &#123;</div><div class="line">  _id : &quot;shard4&quot;,</div><div class="line">    members : [</div><div class="line">     &#123;_id : 0, host : &quot;10.131.185.19:27004&quot; &#125;,</div><div class="line">     &#123;_id : 1, host : &quot;10.131.185.20:27004&quot; &#125;,</div><div class="line">     &#123;_id : 2, host : &quot;10.131.185.16:27004&quot;, arbiterOnly : true&#125;</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line"></div><div class="line"></div><div class="line">#初始化副本集配置</div><div class="line">rs.initiate(config);</div><div class="line"></div><div class="line"></div><div class="line">#查看分区状态</div><div class="line">rs.status();</div></pre></td></tr></table></figure>
<h3 id="第五个分片副本集"><a href="#第五个分片副本集" class="headerlink" title="第五个分片副本集"></a>第五个分片副本集</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">mkdir -p /export/mongodb/shard5/&#123;log,data&#125;</div><div class="line"></div><div class="line"># vim /export/mongodb/shard5/shard5.conf</div><div class="line"># where to write logging data.</div><div class="line">systemLog:</div><div class="line">  destination: file</div><div class="line">  logAppend: true</div><div class="line">  path: /export/mongodb/shard5/log/shard5.log</div><div class="line"> </div><div class="line"># Where and how to store data.</div><div class="line">storage:</div><div class="line">  dbPath: /export/mongodb/shard5/data</div><div class="line">  journal:</div><div class="line">    enabled: true</div><div class="line">  wiredTiger:</div><div class="line">    engineConfig:</div><div class="line">       cacheSizeGB: 20</div><div class="line"></div><div class="line"># how the process runs</div><div class="line">processManagement:</div><div class="line">  fork: true </div><div class="line">  pidFilePath: /export/mongodb/shard5/shard5.pid</div><div class="line"> </div><div class="line"># network interfaces</div><div class="line">net:</div><div class="line">  port: 27005</div><div class="line">  bindIp: 10.131.185.20</div><div class="line"></div><div class="line">#operationProfiling:</div><div class="line">replication:</div><div class="line">    replSetName: shard5</div><div class="line">sharding:</div><div class="line">    clusterRole: shardsvr</div><div class="line"></div><div class="line"># chown -R mongod:mongod /export/mongodb/shard5</div><div class="line"># vim /export/mongodb/shard5/shard5</div><div class="line"># chmod +x /export/mongodb/shard5/shard5</div><div class="line"># /export/mongodb/shard5/shard5 start</div></pre></td></tr></table></figure>
<p>登陆任意一台非仲裁服务器，初始化副本集</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">mongo 10.131.185.20:27005</div><div class="line">#使用admin数据库</div><div class="line">use admin</div><div class="line">#定义副本集配置</div><div class="line">config = &#123;</div><div class="line">  _id : &quot;shard5&quot;,</div><div class="line">    members : [</div><div class="line">     &#123;_id : 0, host : &quot;10.131.185.20:27005&quot; &#125;,</div><div class="line">     &#123;_id : 1, host : &quot;10.131.185.16:27005&quot; &#125;,</div><div class="line">     &#123;_id : 2, host : &quot;10.131.185.17:27005&quot;, arbiterOnly : true&#125;</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line"></div><div class="line"></div><div class="line">#初始化副本集配置</div><div class="line">rs.initiate(config);</div><div class="line"></div><div class="line"></div><div class="line">#查看分区状态</div><div class="line">rs.status();</div></pre></td></tr></table></figure>
<h3 id="配置路由服务器-mongos"><a href="#配置路由服务器-mongos" class="headerlink" title="配置路由服务器 mongos"></a>配置路由服务器 mongos</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">mkdir -p /export/mongodb/mongos/log</div><div class="line"></div><div class="line"># vim /export/mongodb/mongos/mongos.conf</div><div class="line">systemLog:</div><div class="line">  destination: file</div><div class="line">  logAppend: true</div><div class="line">  path: /export/mongodb/mongos/log/mongos.log</div><div class="line">processManagement:</div><div class="line">  fork: true</div><div class="line">  pidFilePath: /export/mongodb/mongos/mongos.pid</div><div class="line"> </div><div class="line"># network interfaces</div><div class="line">net:</div><div class="line">  port: 20000</div><div class="line">  bindIp: 10.131.185.16</div><div class="line">#监听的配置服务器,只能有1个或者3个 config为配置服务器的副本集名字</div><div class="line">sharding:</div><div class="line">   configDB: config/10.131.185.18:21000,10.131.185.19:21000,10.131.185.20:21000</div><div class="line"></div><div class="line"># chown -R mongod:mongod /export/mongodb/mongos</div><div class="line"># vim /export/mongodb/mongos/mongos</div><div class="line"># chmod +x /export/mongodb/mongos/mongos</div><div class="line"># /export/mongodb/mongos/mongos start</div></pre></td></tr></table></figure>
<p>登陆任意一台mongos</p>
<p>mongo 10.131.185.16:20000</p>
<p>#使用admin数据库<br>use  admin</p>
<p>#串联路由服务器与分配副本集<br>sh.addShard(“shard1/10.131.185.16:27001,10.131.185.17:27001,10.131.185.18:27001”)<br>sh.addShard(“shard2/10.131.185.17:27002,10.131.185.18:27002,10.131.185.19:27002”)<br>sh.addShard(“shard3/10.131.185.18:27003,10.131.185.19:27003,10.131.185.20:27003”)<br>sh.addShard(“shard4/10.131.185.19:27004,10.131.185.20:27004,10.131.185.16:27004”)<br>sh.addShard(“shard5/10.131.185.20:27005,10.131.185.16:27005,10.131.185.17:27005”)</p>
<p>#查看集群状态<br>sh.status()</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/MongoDB/" rel="tag"># MongoDB</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/09/05/PHP Webtatic Yum Repository/" rel="next" title="PHP Webtatic Yum Repository">
                <i class="fa fa-chevron-left"></i> PHP Webtatic Yum Repository
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.jpg"
               alt="qingyu.li" />
          <p class="site-author-name" itemprop="name">qingyu.li</p>
           
              <p class="site-description motion-element" itemprop="description">简单不先于复杂，而是在复杂之后</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">31</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">32</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://piandeng.com/" title="Piandeng" target="_blank">Piandeng</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Configure-the-package-management-system-yum"><span class="nav-number">1.</span> <span class="nav-text">Configure the package management system (yum).</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#For-MongoDB-3-6"><span class="nav-number">1.1.</span> <span class="nav-text">For MongoDB 3.6</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#For-versions-of-MongoDB-earlier-than-3-6"><span class="nav-number">1.2.</span> <span class="nav-text">For versions of MongoDB earlier than 3.6</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Install-the-MongoDB-packages"><span class="nav-number">2.</span> <span class="nav-text">Install the MongoDB packages.</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Run-MongoDB-Community-Edition"><span class="nav-number">3.</span> <span class="nav-text">Run MongoDB Community Edition</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Configure-SELinux"><span class="nav-number">3.1.</span> <span class="nav-text">Configure SELinux</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Data-Directories-and-Permissions"><span class="nav-number">3.2.</span> <span class="nav-text">Data Directories and Permissions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Procedure"><span class="nav-number">3.3.</span> <span class="nav-text">Procedure</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Start-MongoDB"><span class="nav-number">3.3.1.</span> <span class="nav-text">Start MongoDB.</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Verify-that-MongoDB-has-started-successfully"><span class="nav-number">3.3.2.</span> <span class="nav-text">Verify that MongoDB has started successfully.</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Stop-MongoDB"><span class="nav-number">3.3.3.</span> <span class="nav-text">Stop MongoDB.</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Restart-MongoDB"><span class="nav-number">3.3.4.</span> <span class="nav-text">Restart MongoDB.</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Begin-using-MongoDB"><span class="nav-number">3.3.5.</span> <span class="nav-text">Begin using MongoDB.</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Uninstall-MongoDB-Community-Edition"><span class="nav-number">4.</span> <span class="nav-text">Uninstall MongoDB Community Edition</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#集群配置"><span class="nav-number">5.</span> <span class="nav-text">集群配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#下载安装"><span class="nav-number">5.1.</span> <span class="nav-text">下载安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#config-server-配置服务器"><span class="nav-number">5.2.</span> <span class="nav-text">config server 配置服务器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第一个分片副本集"><span class="nav-number">5.3.</span> <span class="nav-text">第一个分片副本集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第二个分片副本集"><span class="nav-number">5.4.</span> <span class="nav-text">第二个分片副本集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第三个分片副本集"><span class="nav-number">5.5.</span> <span class="nav-text">第三个分片副本集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第四个分片副本集"><span class="nav-number">5.6.</span> <span class="nav-text">第四个分片副本集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第五个分片副本集"><span class="nav-number">5.7.</span> <span class="nav-text">第五个分片副本集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置路由服务器-mongos"><span class="nav-number">5.8.</span> <span class="nav-text">配置路由服务器 mongos</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">qingyu.li</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("FqAp90PI86NxdOHOxWQ0VrFS-gzGzoHsz", "GKvXMFDzPRF3a0w9BaOEx52z");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.0"></script>



  

</body>
</html>
